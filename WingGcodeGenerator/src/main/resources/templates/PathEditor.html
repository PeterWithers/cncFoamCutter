<!DOCTYPE html>
<!--
Copyright (C) 2015 Peter Withers
-->

<!--
 * @since Oct 3, 2015 10:42:04 PM (creation date)
 * @author <peter@bambooradical.com>
-->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Path Editor</title>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    </head>
    <body>
        <div th:fragment="pathEditor">
            <div id="pathEditorForm">
                <form method="POST" action="#">                    
                    <input type="text" name="datText" id="datText"/><label><input type="checkbox" onchange="updatePath()" checked="true" name="isBezier" id="isBezier" value="isBezier"/>Bezier</label><button type="submit" id="saveButton">Upload</button>
                </form>
            </div>
            <svg id="editSvgPanel" viewBox="-25 -25 150 50">
                <path class="aerofoilEditLines" id="bezierPath" d="M0,0 C20,10 50,10 50,20"/>
                <circle class="dragHandle" id="dragHandle0" cx="0" cy="0" r="2" />
                <circle class="dragHandle" id="dragHandle1" cx="10" cy="10" r="2" onmousedown="start(evt)" onmousemove="move(evt)" onmouseup="stop(evt)" onmouseout="move(evt)" />
                <circle class="dragHandle" id="dragHandle2" cx="90" cy="-10" r="2" onmousedown="start(evt)" onmousemove="move(evt)" onmouseup="stop(evt)" onmouseout="move(evt)" />
                <circle class="dragHandle" id="dragHandle3" cx="100" cy="0" r="2" onmousedown="start(evt)" onmousemove="move(evt)" onmouseup="stop(evt)" onmouseout="move(evt)" />
                <circle class="dragHandle" id="dragHandle4" cx="90" cy="10" r="2" onmousedown="start(evt)" onmousemove="move(evt)" onmouseup="stop(evt)" onmouseout="move(evt)" />
                <circle class="dragHandle" id="dragHandle5" cx="10" cy="10" r="2" onmousedown="start(evt)" onmousemove="move(evt)" onmouseup="stop(evt)" onmouseout="move(evt)" />
            </svg>
            <script>
                var move = function (evt) {
                    if (evt.buttons !== 0) {
                        event.target.setAttribute('cx', (evt.offsetX * 150 / $("#editSvgPanel")[0].clientWidth) - 25);
                        event.target.setAttribute('cy', (evt.offsetY * 150 / $("#editSvgPanel")[0].clientWidth) - 25);
                        updatePath();
                    }
                }
                var updatePath = function () {
                        $("#dragHandle3").attr("cx", 100);
                        var pathType = ($("#isBezier").prop('checked'))? "C" : "";
                        var pathString = 'M' + $("#dragHandle0").attr("cx") + ',' + $("#dragHandle0").attr("cy") +
                                ' ' + pathType + $("#dragHandle1").attr("cx") + ',' + $("#dragHandle1").attr("cy") +
                                ' ' + $("#dragHandle2").attr("cx") + ',' + $("#dragHandle2").attr("cy") +
                                ' ' + $("#dragHandle3").attr("cx") + ',' + $("#dragHandle3").attr("cy") +
                                ' ' + pathType + $("#dragHandle4").attr("cx") + ',' + $("#dragHandle4").attr("cy") +
                                ' ' + $("#dragHandle5").attr("cx") + ',' + $("#dragHandle5").attr("cy") +
                                ' ' + $("#dragHandle0").attr("cx") + ',' + $("#dragHandle0").attr("cy")
                        $("#bezierPath").attr('d', pathString);                    
                        $("#datText").val(pathString);                    
                }
                var start = function (evt) {
                    console.log('start dragging');
                }
                var stop = function (evt) {
                    console.log('finished dragging');
                }
                updatePath();
            </script>
        </div>
    </body>
</html>
